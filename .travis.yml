os: linux
dist: xenial
sudo: true

language: python
cache: pip

python:
  - "3.6"
  - "3.7"

install:
  - python -m pip install $(cat requirements-test.txt)
  - python -m pip install .
  - python setup.py bdist_wheel --python-tag=py2.py3
  - python -m pip uninstall -y lib3to6
  - python -m pip install $(ls -1t dist/lib3to6*.whl | head -n 1)

script:
  - export PYTHONPATH=src/:$PYTHONPATH
  - export MYPYPATH=stubs/
  - python -m flake8 src/lib3to6/
  - python -m mypy src/lib3to6/
  - python -m pytest --cov=lib3to6 test/
  - rst2html5 --strict README.rst > /dev/null
